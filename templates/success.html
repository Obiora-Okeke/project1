<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src = "https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Rajdhani:wght@300&display=swap');
        @import url('https://db.onlinewebfonts.com/c/01173b246d9d9ea808ea75a26b3b61bb?family=CircularSpotifyTxT-Black');
    </style>
    <link rel="stylesheet" type="text/css" href='static/main.css'>
    <title>Album Successfully Created</title>
</head>
<body class="left-right-margin">
    <header class="site-header">
        <nav class="navbar navbar-expand-md navbar-dark bg-steel fixed-top">
          <div class="container">
            <a class="navbar-brand mr-4 inc250" href="/">SPG</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarToggle" aria-controls="navbarToggle" aria-expanded="false" aria-label="Toggle navigation">
              <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarToggle">
              <div class="navbar-nav mr-auto">
                <a class="nav-item nav-link" href="/">Home</a>
                <a class="nav-item nav-link" href="/about">About</a>
              </div>
            </div>
          </div>
        </nav>
    </header>

    
<br>
<h1>Your album has been created!</h1>
<h2 class="inc250"> You can now see your playlist in your Spotify account. </h2>
<a class="inc250" href="https://open.spotify.com/playlist/{{playlist_id}}"> View Playlist in Spotify <img src="img\spotifyLogo.png"> </a><br>
<a class="btn btn-primary inc250 but top-bottom-margin" href="/spotify-generator">Generate Another Playlist</a>
    <script>
        document.querySelector("form").onsubmit = function(e) {

            //e.preventDefault();

            let formData = new FormData();
            let artist = document.querySelector("input[name=artist]").value;
            let username = document.querySelector("input[name=username]").value;
            let playlist = document.querySelector("input[name=playlist]").value;

            formData.append("artist", artist);
            formData.append("username", username);
            formData.append("playlist", playlist);
            fetch("/spotify-generator", {
                method: "POST",
                body: formData
            })
            .then(function(response) {
                // This right here is the response we will receive before we convert
                // it over to readable JSON
                console.log("Response turning to readable JSON", response);
                return response.json();
            })
            .then(function(response) {
                // Don't worry if this says "false", it just returns that when the user already exists from flasks end
                // Once it reaches here, the async is already successful
                console.log("Successful async: ");
                //redirect to success page

            })
            .catch(function(error) {
                console.log("Error in async", error);
            });
        }
    </script>

<!-- Popover -->
<div id="popup" class="popover">
    <div class="arrow"></div>
    <h3 class="popover-title">Bottom</h3>
    <div class="popover-content">
        <p>
            <!-- <a href="#" class="btn btn-default helloWorld">Click me</a> -->
        </p>
    </div>
</div>


<!-- Modal -->
<div class="modal fade" id="myModal" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalLabel"> </h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <pre>
        <div class="modal-body" type="body" id = "body">
                <!-- <input type="text" name="lyrics" id="lyrics" value=""/> -->
                <!-- <div id='rg_embed_link_727466' class='rg_embed_link' data-song-id='727466'>Read <a href='https://genius.com/The-weeknd-the-hills-lyrics'>“The Hills” by The Weeknd</a> on Genius</div> <script crossorigin src='//genius.com/songs/727466/embed.js'></script> -->
        </div>
        </pre>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary" onClick = 'getAnnotations()'>Get Annotations</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Modal -->
<!-- <div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="exampleModalScrollableTitle" aria-hidden="true">
    <div class="modal-dialog modal-dialog-scrollable" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="exampleModalScrollableTitle">Modal title</h5>
          <button type="button" class="close" data-dismiss="modal" aria-label="Close">
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
        <div class="modal-body">
            <input type="text" name="lyrics" id="lyrics" value=""/>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
          <button type="button" class="btn btn-primary">Save changes</button>
        </div>
      </div>
    </div>
  </div> -->

<!-- Modal -->

      

{% for track_id in track_ids %}
<div class="frame-container">
    {% set spotify_track_id = track_id %}
    <!-- <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#myModal" data-bs-whatever="@fat">Open modal for @fat</button> -->
    <button type = "button" class="iframe-button btn btn-primary" data-id ="{{spotify_track_id}}" data-bs-toggle="modal" href="#myModal">
       Lyrics
    </button>
    <!-- <button class="iframe-button" id ="{{spotify_track_id}}" onclick = 'buttonClicked(id)'> </button> -->
    <!-- <button type="button" class="btn btn-info btn-lg" data-toggle="modal" data-target="#exampleModal">Open Modal</button> -->

 <!--  <input type="iframe-button" class="'iframe-button" onclick="buttonClicked()" value='Lyrics'> -->
    <iframe class="test3" style="border-radius:12px" src="https://open.spotify.com/embed/track/{{ track_id }}?utm_source=generator" width="100%" height="80" frameBorder="0" allowfullscreen="" allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" loading="lazy">
    </iframe>
</div>
{% endfor %}

<script>
// $('#myModal').on('show.bs.modal', function (event, callback) {
//     // var button = $(event.relatedTarget) // Button that triggered the modal
//     // var recipient = button.data('whatever') // Extract info from data-* attributes
//   // If necessary, you could initiate an AJAX request here (and then do the updating in a callback).
//   // Update the modal's content. We'll use jQuery here, but you could use a data binding library or other methods instead.
//     var button = $(event.relatedTarget)
//     console.log('id: ', id)
//     var id = button.data('id')
//     var response = buttonClicked(id);
//     var modal = $(this)
//     modal.find('.modal-body').text(response)
// })

$(document).on("click", ".iframe-button", function () {
     var id = $(this).data('id');
     let formData = new FormData();
     formData.append("id", id);
            // alert(id);
    fetch("/get-lyrics", {
        method: "POST",
        body: formData
    })
    .then(function(response) {
          // This right here is the response we will receive before we convert
          // it over to readable JSON
        console.log("Response turning to readable JSON", response);
        return response.json();
    })
    .then(function(response) {
        // $(".modal-body #lyrics").val( response );
        var modal = document.getElementById('myModal')

        // modal.querySelector(".modal-body").innerHTML = response[1];

        modal.querySelector(".modal-body").innerHTML = response[1]
        // $(".modal-body").html( response[1] );
        // let genius = response[1]
        // var myScript = response[1].getElementsByTagName('script')[0].outerHTML;
        // postscribe('#myDiv', myScript);
        // $('rg_embed_link').find('input');
        // var script = document.createElement("script");  
        // var innerScript = response[1].find('script');
        // console.log(innerScript);
        // script.src = innerScript.src; 
        // document.head.appendChild(script);
        modal.querySelector(".modal-title").innerHTML = response[0] + " Lyrics";
        // $(".modal-body").val( response );
    })
    .catch(function(error) {
          console.log("Error in async", error);
    });
});

function getAnnotations() {
    fetch("/get-annotations", {
        method: "POST"
    })
    .then(function(response) {
          // This right here is the response we will receive before we convert
          // it over to readable JSON
        console.log("Response turning to readable JSON", response);
        return response.json();
    })




};

// function buttonClicked(id, callback) {
//         let formData = new FormData();
//         formData.append("id", id);
//             // alert(id);
//         fetch("/get-lyrics", {
//             method: "POST",
//             body: formData
//         })
//         // $('#myModal').modal('hide')
//         .then(function(response) {
//           // This right here is the response we will receive before we convert
//           // it over to readable JSON
          
//           console.log("Response turning to readable JSON", response);
//           return response.text();
//         })
//         // .then(function(response) {
            
//         //   // Don't worry if this says "false", it just returns that when the user already exists from flasks end
//         //   // Once it reaches here, the async is already successful
//         // //   console.log("Successful async:", response);
        
//         // // document.getElementById(modal).display = 'block';
//         //     // alert(response);
//         // })
//         .catch(function(error) {
//           console.log("Error in async", error);
//         });
//     };
</script>




<br>
<br>

</body>
</html>